#timestamp Tue May 31 04:11:37 EEST 2022
version: 2.1

executors:
 fmi-executor:
  docker:
   - image: fmidev/smartmet-cibase-7:latest
  resource_class: xlarge
  environment:
     RPM_BUILD_NCPUS: 8

commands:
 build-default:
  description: Build and save artifacts for other steps
  parameters: 
   module:
    type: string
  steps:
   - run:
      name: Disable smartmet packages coming from FMI repo
      command: sudo yum-config-manager --quiet --disable smartmet-open --disable smartmet-open-beta
   - checkout
   - attach_workspace:
      at: /dist
   - run:
      name: Create repository out of dependant RPMs
      command: |
        sudo mkdir -p /repo
        sudo ln -s /dist/*.rpm /repo/
        sudo createrepo_c /repo
        sudo touch /etc/yum.repos.d/localrepo.repo
        sudo chmod 666 /etc/yum.repos.d/localrepo.repo
        echo '[localrepo]' > /etc/yum.repos.d/localrepo.repo
        echo name="Local Repository" >> /etc/yum.repos.d/localrepo.repo
        echo gpgcheck=0 >> /etc/yum.repos.d/localrepo.repo
        echo enabled=1 >> /etc/yum.repos.d/localrepo.repo
        echo priority=1 >> /etc/yum.repos.d/localrepo.repo
        echo baseurl=file:///repo >> /etc/yum.repos.d/localrepo.repo
   - run:
      name: Checkout module for $CIRCLE_JOB
      command: ./getsource.sh
   - run:
      name: Install build dependencies
      command: |
        cd /tmp/build
        ci-build deps
   - run:
      name: Build RPM
      command: |
        cd /tmp/build
        ci-build rpm
   - persist_to_workspace:
      root: /dist
      paths:
       - ./<< parameters.module >>-*.rpm
       - ./<< parameters.module >>.lst

 test-default:
  description: Test
  steps:
   - run:
      name: Disable smartmet packages coming from FMI repo
      command: sudo yum-config-manager --quiet --disable smartmet-open --disable smartmet-open-beta
   - checkout
   - attach_workspace:
      at: /dist
   - run:
      name: Create repository out of dependant RPMs
      command: |
        sudo mkdir -p /repo
        sudo ln -s /dist/*.rpm /repo/
        sudo createrepo_c /repo
        sudo touch /etc/yum.repos.d/localrepo.repo
        sudo chmod 666 /etc/yum.repos.d/localrepo.repo
        echo '[localrepo]' > /etc/yum.repos.d/localrepo.repo
        echo name="Local Repository" >> /etc/yum.repos.d/localrepo.repo
        echo gpgcheck=0 >> /etc/yum.repos.d/localrepo.repo
        echo enabled=1 >> /etc/yum.repos.d/localrepo.repo
        echo priority=1 >> /etc/yum.repos.d/localrepo.repo
        echo baseurl=file:///repo >> /etc/yum.repos.d/localrepo.repo
   - run:
      name: Checkout module for $CIRCLE_JOB
      command: ./getsource.sh
   - run:
      name: Installation test
      command: |
        cd /tmp/build
        lst=`basename *.spec .spec`.lst  # RPM list file
        ( cd /dist ; for i in `cat $lst | fgrep -v .src.rpm` ; do sudo yum install -y $i ; done )
   - run:
      name: Test prepare
      command: cd /tmp/build && ci-build testprep
   - run:
      name: Test
      command: cd /tmp/build && ci-build test
 
jobs:
# Ordinarily lines starting with # are comments but config preprocessing recognizes certain directives
# Config rebuilder uses lines between #template .. #end as a sort of template, currently:
# build: a template for a build task, smartmet-* are replaced with respective module
# test: a template for a test task, smartmet-* are replaced with respective module
# pre: starts a block for jobs which should be run before everything else(i.e. check config rebuilding, common workspace setup)
# post: starts a block for jobs which should be run after everything else(i.e. collect artifacts, setup repository)
# If you need multiple pre/post processing jobs(unlikely, you could just put in more steps), make several templates
#template build
  build-smartmet-engine-authentication:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-authentication
  build-smartmet-engine-contour:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-contour
  build-smartmet-engine-geonames:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-geonames
  build-smartmet-engine-gis:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-gis
  build-smartmet-engine-grid:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-grid
  build-smartmet-engine-observation:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-observation
  build-smartmet-engine-querydata:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-querydata
  build-smartmet-engine-sputnik:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-engine-sputnik
  build-smartmet-frontier:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-frontier
  build-smartmet-library-calculator:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-calculator
  build-smartmet-library-gis:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-gis
  build-smartmet-library-giza:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-giza
  build-smartmet-library-grid-content:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-grid-content
  build-smartmet-library-grid-files:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-grid-files
  build-smartmet-library-imagine:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-imagine
  build-smartmet-library-imagine2:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-imagine2
  build-smartmet-library-locus:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-locus
  build-smartmet-library-macgyver:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-macgyver
  build-smartmet-library-newbase:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-newbase
  build-smartmet-library-regression:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-regression
  build-smartmet-library-smarttools:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-smarttools
  build-smartmet-library-spine:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-spine
  build-smartmet-library-textgen:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-textgen
  build-smartmet-library-timeseries:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-timeseries
  build-smartmet-library-trajectory:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-trajectory
  build-smartmet-library-trax:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-trax
  build-smartmet-library-tron:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-tron
  build-smartmet-library-woml:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-library-woml
  build-smartmet-plugin-admin:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-admin
  build-smartmet-plugin-autocomplete:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-autocomplete
  build-smartmet-plugin-backend:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-backend
  build-smartmet-plugin-cross_section:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-cross_section
  build-smartmet-plugin-download:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-download
  build-smartmet-plugin-frontend:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-frontend
  build-smartmet-plugin-grid-admin:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-grid-admin
  build-smartmet-plugin-grid-gui:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-grid-gui
  build-smartmet-plugin-meta:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-meta
  build-smartmet-plugin-textgen:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-textgen
  build-smartmet-plugin-timeseries:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-timeseries
  build-smartmet-plugin-trajectory:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-trajectory
  build-smartmet-plugin-wfs:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-wfs
  build-smartmet-plugin-wms:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-plugin-wms
  build-smartmet-qdcontour:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-qdcontour
  build-smartmet-qdcontour2:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-qdcontour2
  build-smartmet-qdtools:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-qdtools
  build-smartmet-server:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-server
  build-smartmet-shapetools:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-shapetools
  build-smartmet-test-db:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-test-db
  build-smartmet-timezones:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-timezones
  build-smartmet-tools-grid:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-tools-grid
  build-smartmet-utils:
    executor: fmi-executor
    steps:
     - build-default:
        module: smartmet-utils
#end
#template test
  test-smartmet-engine-authentication:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-engine-contour:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-engine-geonames:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-engine-gis:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-engine-observation:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-frontier:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-calculator:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-gis:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-giza:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-imagine:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-imagine2:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-locus:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-macgyver:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-newbase:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-regression:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-spine:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-textgen:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-timeseries:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-trax:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-tron:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-library-woml:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-autocomplete:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-cross_section:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-download:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-meta:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-textgen:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-timeseries:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-wfs:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-plugin-wms:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-qdcontour:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-qdcontour2:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-qdtools:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-server:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-test-db:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-timezones:
    executor: fmi-executor
    steps:
     - test-default
  test-smartmet-utils:
    executor: fmi-executor
    steps:
     - test-default
#end
#template pre
# This job runs before we build anything
  preprep:
    executor: fmi-executor
    steps:
     - checkout
     - run:
        name: Check that config.yml is current
        command: |
          circleci version || ( curl -fLSs https://circle.ci/cli | sudo bash )
          make -v >/dev/null 2>&1 || sudo yum install -y make
          sudo yum install -y perl-Data-Dumper || true
          make check
     - run:
        name: Download RPMs not built on Circle-CI to local repo
        command:
          yumdownloader smartmet-test-data && sudo mv *.rpm /dist
     - persist_to_workspace:
          root: /dist
          paths:
            - ./*.rpm

#end
#template post
# This job runs after everything is built and tested
  archive:
    executor: fmi-executor
    steps:
     - checkout
     - attach_workspace:
        at: /dist
     - run:
        name: Create repository
        command: |
          rm -f /dist/*.lst
          createrepo_c /dist
     - store_artifacts:
        path: /dist
#end
# This is only triggered by the scheduled workflow
  rebuild_config:
    executor: fmi-executor
    steps:
     - checkout
     - add_ssh_keys:
         fingerprints:
          - "SHA256:Fi/Kn2XEO65HE+LE4p09TZw3rnWkHtMiRkYovG1O1LA"
     - run:
        name: Rebuild CirleCI configuration
        command: |
          circleci version || ( curl -fLSs https://circle.ci/cli | sudo bash )
          make -v >/dev/null 2>&1 || sudo yum install -y make
          sudo yum install -y perl-Data-Dumper || true
          make force
     - run:
        name: Commit changed config.yml to trigger full build
        command: |
          git config --global --get user.email || git config --global user.email "noreply-smartmet-autobuilder@fmi.fi"
          git config --global --get user.name || git config --global user.name "Smartmet server CI config autobuilder"
          git commit -m "Config rebuild on `date`" .circleci/config.yml
          git push

workflows:
  version: 2.1
  scheduled:
   triggers:
    - schedule:
       cron: "10 1 * * *"
       filters:
        branches:
         only:
         # You could leave the branch list empty but building for master and devel for now
         # You can always add your branch here, if you branch this repository
          - master
          - devel
   jobs:
    - rebuild_config
  on-commit:
   jobs:
# Dependency tree will be completely rebuilt by config-rebuilder
# Template still needed for indentation lookup and placement
#template deptree
    - preprep
    - build-smartmet-engine-authentication:
       requires:
        - preprep
        - test-smartmet-library-spine
    - build-smartmet-engine-contour:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-trax
    - build-smartmet-engine-geonames:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
    - build-smartmet-engine-gis:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-utils
    - build-smartmet-engine-grid:
       requires:
        - preprep
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-spine
    - build-smartmet-engine-observation:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-utils
    - build-smartmet-engine-querydata:
       requires:
        - preprep
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-engine-sputnik:
       requires:
        - preprep
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
    - build-smartmet-frontier:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-tron
        - test-smartmet-library-woml
    - build-smartmet-library-calculator:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
    - build-smartmet-library-gis:
       requires:
        - preprep
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
    - build-smartmet-library-giza:
       requires:
        - preprep
        - test-smartmet-library-macgyver
    - build-smartmet-library-grid-content:
       requires:
        - preprep
        - test-smartmet-library-gis
        - build-smartmet-library-grid-files
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
    - build-smartmet-library-grid-files:
       requires:
        - preprep
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-trax
    - build-smartmet-library-imagine:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
    - build-smartmet-library-imagine2:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
    - build-smartmet-library-locus:
       requires:
        - preprep
        - test-smartmet-library-macgyver
    - build-smartmet-library-macgyver:
       requires:
        - preprep
        - test-smartmet-library-regression
        - test-smartmet-timezones
        - test-smartmet-utils
    - build-smartmet-library-newbase:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
    - build-smartmet-library-regression:
       requires:
        - preprep
        - test-smartmet-utils
    - build-smartmet-library-smarttools:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
    - build-smartmet-library-spine:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-utils
    - build-smartmet-library-textgen:
       requires:
        - preprep
        - test-smartmet-library-calculator
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
    - build-smartmet-library-timeseries:
       requires:
        - preprep
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-utils
    - build-smartmet-library-trajectory:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - build-smartmet-library-smarttools
    - build-smartmet-library-trax:
       requires:
        - preprep
        - test-smartmet-library-macgyver
    - build-smartmet-library-tron:
       requires:
        - preprep
        - test-smartmet-library-macgyver
    - build-smartmet-library-woml:
       requires:
        - preprep
        - test-smartmet-library-macgyver
    - build-smartmet-plugin-admin:
       requires:
        - preprep
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - build-smartmet-engine-sputnik
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-plugin-autocomplete:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - build-smartmet-engine-querydata
        - build-smartmet-engine-sputnik
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-plugin-backend:
       requires:
        - preprep
        - build-smartmet-engine-sputnik
        - test-smartmet-library-spine
    - build-smartmet-plugin-cross_section:
       requires:
        - preprep
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - build-smartmet-engine-grid
        - build-smartmet-engine-querydata
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
    - build-smartmet-plugin-download:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - build-smartmet-engine-grid
        - build-smartmet-engine-querydata
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-plugin-frontend:
       requires:
        - preprep
        - build-smartmet-engine-sputnik
        - build-smartmet-library-grid-files
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-plugin-grid-admin:
       requires:
        - preprep
        - build-smartmet-engine-grid
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
    - build-smartmet-plugin-grid-gui:
       requires:
        - preprep
        - build-smartmet-engine-grid
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-spine
    - build-smartmet-plugin-meta:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-plugin-textgen:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-querydata
        - test-smartmet-library-calculator
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-textgen
    - build-smartmet-plugin-timeseries:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
    - build-smartmet-plugin-trajectory:
       requires:
        - preprep
        - test-smartmet-engine-geonames
        - build-smartmet-engine-querydata
        - test-smartmet-library-macgyver
        - build-smartmet-library-smarttools
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - build-smartmet-library-trajectory
    - build-smartmet-plugin-wfs:
       requires:
        - preprep
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
    - build-smartmet-plugin-wms:
       requires:
        - preprep
        - test-smartmet-engine-authentication
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - test-smartmet-library-giza
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
    - build-smartmet-qdcontour:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-imagine
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-tron
    - build-smartmet-qdcontour2:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-imagine2
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-tron
    - build-smartmet-qdtools:
       requires:
        - preprep
        - test-smartmet-library-calculator
        - test-smartmet-library-gis
        - test-smartmet-library-imagine
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - build-smartmet-library-smarttools
        - test-smartmet-timezones
    - build-smartmet-server:
       requires:
        - preprep
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
    - build-smartmet-shapetools:
       requires:
        - preprep
        - test-smartmet-library-gis
        - test-smartmet-library-imagine
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
    - build-smartmet-test-db:
       requires:
        - preprep
    - build-smartmet-timezones:
       requires:
        - preprep
    - build-smartmet-tools-grid:
       requires:
        - preprep
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-spine
    - build-smartmet-utils:
       requires:
        - preprep
    - test-smartmet-engine-authentication:
       requires:
        - build-smartmet-engine-authentication
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-server
        - test-smartmet-utils
    - test-smartmet-engine-contour:
       requires:
        - build-smartmet-engine-contour
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
    - test-smartmet-engine-geonames:
       requires:
        - build-smartmet-engine-geonames
        - test-smartmet-library-gis
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-server
        - test-smartmet-test-db
    - test-smartmet-engine-gis:
       requires:
        - build-smartmet-engine-gis
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-engine-observation:
       requires:
        - build-smartmet-engine-observation
        - test-smartmet-engine-geonames
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-server
        - test-smartmet-utils
    - test-smartmet-frontier:
       requires:
        - build-smartmet-frontier
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-tron
        - test-smartmet-library-woml
    - test-smartmet-library-calculator:
       requires:
        - build-smartmet-library-calculator
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-timezones
    - test-smartmet-library-gis:
       requires:
        - build-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
    - test-smartmet-library-giza:
       requires:
        - build-smartmet-library-giza
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
    - test-smartmet-library-imagine:
       requires:
        - build-smartmet-library-imagine
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
    - test-smartmet-library-imagine2:
       requires:
        - build-smartmet-library-imagine2
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
    - test-smartmet-library-locus:
       requires:
        - build-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
        - test-smartmet-test-db
    - test-smartmet-library-macgyver:
       requires:
        - build-smartmet-library-macgyver
        - test-smartmet-library-regression
        - test-smartmet-timezones
        - test-smartmet-utils
    - test-smartmet-library-newbase:
       requires:
        - build-smartmet-library-newbase
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
        - test-smartmet-timezones
    - test-smartmet-library-regression:
       requires:
        - build-smartmet-library-regression
        - test-smartmet-utils
    - test-smartmet-library-spine:
       requires:
        - build-smartmet-library-spine
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-timezones
    - test-smartmet-library-textgen:
       requires:
        - build-smartmet-library-textgen
        - test-smartmet-library-calculator
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-timezones
    - test-smartmet-library-timeseries:
       requires:
        - build-smartmet-library-timeseries
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-timezones
        - test-smartmet-utils
    - test-smartmet-library-trax:
       requires:
        - build-smartmet-library-trax
        - test-smartmet-library-macgyver
    - test-smartmet-library-tron:
       requires:
        - build-smartmet-library-tron
        - test-smartmet-library-gis
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
    - test-smartmet-library-woml:
       requires:
        - build-smartmet-library-woml
        - test-smartmet-library-macgyver
        - test-smartmet-library-regression
    - test-smartmet-plugin-autocomplete:
       requires:
        - build-smartmet-plugin-autocomplete
        - test-smartmet-engine-geonames
        - build-smartmet-engine-querydata
        - build-smartmet-engine-sputnik
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-cross_section:
       requires:
        - build-smartmet-plugin-cross_section
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - build-smartmet-engine-grid
        - build-smartmet-engine-querydata
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-download:
       requires:
        - build-smartmet-plugin-download
        - test-smartmet-engine-geonames
        - build-smartmet-engine-grid
        - build-smartmet-engine-querydata
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-qdtools
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-meta:
       requires:
        - build-smartmet-plugin-meta
        - test-smartmet-engine-geonames
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-textgen:
       requires:
        - build-smartmet-plugin-textgen
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-querydata
        - test-smartmet-library-calculator
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-textgen
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-timeseries:
       requires:
        - build-smartmet-plugin-timeseries
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-wfs:
       requires:
        - build-smartmet-plugin-wfs
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-utils
    - test-smartmet-plugin-wms:
       requires:
        - build-smartmet-plugin-wms
        - test-smartmet-engine-authentication
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - build-smartmet-engine-grid
        - test-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - test-smartmet-library-gis
        - test-smartmet-library-giza
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-spine
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
        - test-smartmet-server
        - test-smartmet-test-db
    - test-smartmet-qdcontour:
       requires:
        - build-smartmet-qdcontour
        - test-smartmet-library-imagine
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-tron
    - test-smartmet-qdcontour2:
       requires:
        - build-smartmet-qdcontour2
        - test-smartmet-library-imagine2
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-tron
    - test-smartmet-qdtools:
       requires:
        - build-smartmet-qdtools
        - test-smartmet-library-calculator
        - test-smartmet-library-gis
        - test-smartmet-library-imagine
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - build-smartmet-library-smarttools
        - test-smartmet-timezones
    - test-smartmet-server:
       requires:
        - build-smartmet-server
        - test-smartmet-library-macgyver
        - test-smartmet-library-spine
    - test-smartmet-test-db:
       requires:
        - build-smartmet-test-db
    - test-smartmet-timezones:
       requires:
        - build-smartmet-timezones
    - test-smartmet-utils:
       requires:
        - build-smartmet-utils
    - archive:
       requires:
        - build-smartmet-engine-authentication
        - build-smartmet-engine-contour
        - build-smartmet-engine-geonames
        - build-smartmet-engine-gis
        - build-smartmet-engine-grid
        - build-smartmet-engine-observation
        - build-smartmet-engine-querydata
        - build-smartmet-engine-sputnik
        - build-smartmet-frontier
        - build-smartmet-library-calculator
        - build-smartmet-library-gis
        - build-smartmet-library-giza
        - build-smartmet-library-grid-content
        - build-smartmet-library-grid-files
        - build-smartmet-library-imagine
        - build-smartmet-library-imagine2
        - build-smartmet-library-locus
        - build-smartmet-library-macgyver
        - build-smartmet-library-newbase
        - build-smartmet-library-regression
        - build-smartmet-library-smarttools
        - build-smartmet-library-spine
        - build-smartmet-library-textgen
        - build-smartmet-library-timeseries
        - build-smartmet-library-trajectory
        - build-smartmet-library-trax
        - build-smartmet-library-tron
        - build-smartmet-library-woml
        - build-smartmet-plugin-admin
        - build-smartmet-plugin-autocomplete
        - build-smartmet-plugin-backend
        - build-smartmet-plugin-cross_section
        - build-smartmet-plugin-download
        - build-smartmet-plugin-frontend
        - build-smartmet-plugin-grid-admin
        - build-smartmet-plugin-grid-gui
        - build-smartmet-plugin-meta
        - build-smartmet-plugin-textgen
        - build-smartmet-plugin-timeseries
        - build-smartmet-plugin-trajectory
        - build-smartmet-plugin-wfs
        - build-smartmet-plugin-wms
        - build-smartmet-qdcontour
        - build-smartmet-qdcontour2
        - build-smartmet-qdtools
        - build-smartmet-server
        - build-smartmet-shapetools
        - build-smartmet-test-db
        - build-smartmet-timezones
        - build-smartmet-tools-grid
        - build-smartmet-utils
        - test-smartmet-engine-authentication
        - test-smartmet-engine-contour
        - test-smartmet-engine-geonames
        - test-smartmet-engine-gis
        - test-smartmet-engine-observation
        - test-smartmet-frontier
        - test-smartmet-library-calculator
        - test-smartmet-library-gis
        - test-smartmet-library-giza
        - test-smartmet-library-imagine
        - test-smartmet-library-imagine2
        - test-smartmet-library-locus
        - test-smartmet-library-macgyver
        - test-smartmet-library-newbase
        - test-smartmet-library-regression
        - test-smartmet-library-spine
        - test-smartmet-library-textgen
        - test-smartmet-library-timeseries
        - test-smartmet-library-trax
        - test-smartmet-library-tron
        - test-smartmet-library-woml
        - test-smartmet-plugin-autocomplete
        - test-smartmet-plugin-cross_section
        - test-smartmet-plugin-download
        - test-smartmet-plugin-meta
        - test-smartmet-plugin-textgen
        - test-smartmet-plugin-timeseries
        - test-smartmet-plugin-wfs
        - test-smartmet-plugin-wms
        - test-smartmet-qdcontour
        - test-smartmet-qdcontour2
        - test-smartmet-qdtools
        - test-smartmet-server
        - test-smartmet-test-db
        - test-smartmet-timezones
        - test-smartmet-utils
#end
